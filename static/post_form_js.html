<script type="text/javascript">
    var $ = jQuery;

    $(document).ready(function () {
        $(".remove_button").click(function (event) {
            event.preventDefault();
            if ($(".tier-wrapper").length == 1) {
                //don't allow removal of last tier
                return false;
            }
            var row = this.parentNode.parentNode.parentNode;
            this.parentNode.parentNode.parentNode.parentNode.removeChild(row);
            return false;
        });

        $(".add_tier_btn").click(function (event) {
            event.preventDefault();
            var element = $($(".tier-wrapper")[0]).clone(true, true);
            var inputs = $(element).find("input,select");
            var numInputs = $(".tier-wrapper select").length;
            for (var i = 0; i < inputs.length; ++i) {
                var item = inputs[i];
                $(item).attr("name", $(item).attr("name").replace("[0]", "[" + numInputs + "]"));
                $(item).attr("id", $(item).attr("id").replace("-0-", "-" + numInputs + "-"));
            }
            var addBtn = $(this).clone(true, true);
            var parent = this.parentNode;

            parent.removeChild(this.parentNode.lastChild);
            $(element).appendTo(parent);
            $(addBtn).appendTo(parent);
            return false;
        });

        $("#edit-imoneza-pricingmodel").change(imoneza_update_display);
    });
    function imoneza_update_display() {


        if ($("#imoneza_isManaged").checked) {
            console.log("checked");
            if ($("#edit-imoneza-name").val() == "" && $("#edit-title"))
                $("#edit-imoneza-name").value = $("#edit-title").value;
            if (document.getElementById("edit-imoneza-title").value == "" && document.getElementById("edit-title"))
                document.getElementById("edit-imoneza-title").value = document.getElementById("edit-title").value;
            if (document.getElementById("edit-imoneza-description").value == "" && document.getElementsByClassName("text-summary"))
                document.getElementById("edit-imoneza-description").value = document.getElementsByClassName("text-summary").value;
        }
        imoneza_toggle_class(".imoneza_row", document.getElementById("imoneza_isManaged").checked);

        if (document.getElementById("imoneza_isManaged").checked) {
            var pm = document.getElementById("edit-imoneza-pricingmodel");
            var selectedPricingModel = pm.options[pm.selectedIndex].value;
            imoneza_toggle_class(".imoneza_row_price", (selectedPricingModel == "FixedPrice" || selectedPricingModel == "VariablePrice"));
            imoneza_toggle_class(".imoneza_row_price_tier", (selectedPricingModel == "TimeTiered" || selectedPricingModel == "ViewTiered"));

            var epu = document.getElementById("edit-imoneza-expirationperiodunit");
            var expirationPeriodUnit = epu.options[epu.selectedIndex].value;
            imoneza_toggle_class(".imoneza_row_price_expiration", (selectedPricingModel == "FixedPrice" || selectedPricingModel == "VariablePrice") && (expirationPeriodUnit != "Never"));

            if ($("#edit-imoneza-pricingmodel").val() === "TimeTiered") {
                $(".tier-selector-wrapper").show();
                $(".view_text").hide();
            } else {
                $(".tier-selector-wrapper").hide();
                $(".view_text").show();
            }
        }


    }

    function imoneza_toggle_class(className, isVisible) {
        var els = document.querySelectorAll(className);
        for (var i = 0; i < els.length; ++i) {
            els[i].style.display = (isVisible ? "table-row" : "none");
        }
    }

    function imoneza_add_tier() {
        var select = document.getElementById("edit-imoneza-pricingmodel").value;
        if (select === "ViewTiered") {

        } else if (select === "TimeTiered") {

        } else {
            //skip it, called by mistake
            return false;
        }


        return false;
    }

    function imoneza_remove_tier(t) {
        var r = t.parentNode.parentNode;
        r.parentNode.removeChild(r);

        return false;
    }


    $(document).ready(function () {
        imoneza_update_display();
    });

</script>

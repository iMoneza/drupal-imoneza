<?php
/**
 * @file
 * The main plugin for imoneza standard
 */

/**
 * Implements hook_help().
 * @param $path string
 * @param $arg mixed
 * @return null|string
 */
function imoneza_help($path, $arg) {
  $help = '';

  switch ($path) {
    case "admin/help#imoneza":
      $help = t("This plugin will add icons to highlight your premium content and message readers using adblockers.");
      break;
  }

  return $help;
}

/**
 * Implements hook_permission().
 */
function imoneza_permission() {
  return array(
    "administer imoneza settings" => array(
      "title" => t("Administer iMoneza Settings"),
      "description" => t("Configure iMoneza settings including choosing premium indicator icons and specifying an adblock message.")
    )
  );
}

/**
 * Implements hook_menu().
 */
function imoneza_menu() {
  $items = array();
  $items["admin/settings/imoneza"] = array(
    "title" => "iMoneza",
    "description" => "iMoneza Settings",
    "page callback" => "drupal_get_form",
    "page arguments" => array("imoneza_admin"),
    "access arguments" => array("administer imoneza settings"),
    "type" => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Hook that displays the admin configuration page for the iMoneza module.
 * @param $form
 * @param $form_state
 * @return mixed
 */
function imoneza_admin($form, &$form_state) {
  $form['show_adblock_notification'] = array(
    '#type' =>  'radios',
    '#title' =>  t('Add a notification for adblockers:'),
    '#default_value'  =>  variable_get('imoneza_show_adblock_notification', 0),
    '#options'  =>  array(0 => t('No'), 1 => t('Yes'))
  );

  $form['adblock_notification'] = array(
    '#type' =>  'textarea',
    '#title'  =>  t('Message for users of ad blockers:'),
    '#default_value'  =>  variable_get('imoneza_adblock_notification', "We noticed you have your ad blocker on.  Is it possible for you to turn it off - just for this site - as a favor?  We wouldn't ask except that our website needs ads to survive.")
  );

  $form['actions']['submit'] = array(
    '#type' =>  'submit',
    '#value'  =>  t('Save Settings')
  );

  return $form;
}

/**
 * Save the admin form items
 *
 * @param $form
 * @param $form_state
 */
function imoneza_admin_submit($form, &$form_state) {
  variable_set('imoneza_show_adblock_notification', $form_state['values']['show_adblock_notification']);
  variable_set('imoneza_adblock_notification', $form_state['values']['adblock_notification']);
  drupal_set_message(t('Your form has been saved.'));
}